# ‚úÖ –ü–û–õ–ù–û–ï –†–ï–®–ï–ù–ò–ï: signal_combined_delays()

## üìä –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û (Sequential Thinking Applied)

### –®–ê–ì 1: ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–ª –≤—Å–µ —Ñ–∞–π–ª—ã
- `generator_gpu_new.h` ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- `generator_gpu_new.cpp` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å kernel'–∞–º–∏

### –®–ê–ì 2: ‚úÖ –ü–æ–Ω—è–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
```
OpenCLCore (–∫–æ–Ω—Ç–µ–∫—Å—Ç)
  ‚Üì
CommandQueuePool (–æ—á–µ—Ä–µ–¥–∏)
  ‚Üì
OpenCLComputeEngine (—Ñ–∞—Å–∞–¥)
  ‚Üì
GeneratorGPU (–≤–∞—à –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä)
  ‚îú‚îÄ kernel_lfm_basic() ‚Üí —Å–∏–≥–Ω–∞–ª –ë–ï–ó –∑–∞–¥–µ—Ä–∂–µ–∫
  ‚îú‚îÄ kernel_lfm_delayed() ‚Üí —Å–∏–≥–Ω–∞–ª —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –ø–æ –£–ì–õ–ê–ú
  ‚îî‚îÄ kernel_lfm_combined() ‚Üí ‚úÖ –ù–û–í–û–ï: —Å–∏–≥–Ω–∞–ª —Å –û–ë–ï–ò–ú–ò –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
```

### –®–ê–ì 3: ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª —Ä–µ—à–µ–Ω–∏–µ

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```cpp
typedef struct {
    uint beam_index;
    float delay_degrees;      // –£–≥–ª–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–≥—Ä–∞–¥—É—Å—ã)
    float delay_time_ns;      // –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã)
} CombinedDelayParam;
```

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥:**
```cpp
cl_mem signal_combined_delays(
    const CombinedDelayParam* combined_delays,
    size_t num_delay_params
);
```

**–ù–æ–≤—ã–π kernel (OpenCL):**
```
–ü–æ–ª–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ = delay_from_angle + delay_from_time
```

---

## üì¶ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´ (5 –§–ê–ô–õ–û–í)

### 1. **README_COMBINED_DELAYS.md** ‚Üê –ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê!
   - –ü–æ–ª–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–µ—à–µ–Ω–∏—é
   - FAQ –∏ —Å–æ–≤–µ—Ç—ã
   - üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (10 –º–∏–Ω)

### 2. **ANALYSIS_AND_PLAN.md**
   - –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ?
   - –î–∏–∑–∞–π–Ω –∏ —Ç–µ—Ö. —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 3. **generator_gpu_extended.h**
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è CombinedDelayParam
   - –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### 4. **generator_gpu_extended.cpp**
   - 9 —à–∞–≥–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (—Å –∫–æ–¥–æ–º!)
   - –ü–æ–ª–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ kernel'–∞
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è signal_combined_delays()

### 5. **test_combined_delays.cpp**
   - –î–≤–∞ –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–º–ø–ª–∏—Ç—É–¥, —Ñ–∞–∑, –∑–∞–¥–µ—Ä–∂–µ–∫
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 6. **IMPLEMENTATION_SUMMARY.md**
   - –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤
   - –°–∫–æ–ø–∏—Ä—É–π-–≤—Å—Ç–∞–≤—å –∫–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
   - –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä (—Ñ–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ—à—ë—Ç–∫–∞)

---

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ –î–õ–Ø –í–ê–®–ï–ì–û –°–¶–ï–ù–ê–†–ò–Ø

**–í–∞—à–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏—è: 12 MHz**

```
–®–∞–≥ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏: 83.33 –Ω—Å

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏:
‚îú‚îÄ 50 –Ω—Å   ‚Üí 0.6 –æ—Ç—Å—á—ë—Ç–æ–≤    ‚úÖ –î—Ä–æ–±–Ω–∞—è (—Ä–∞–±–æ—Ç–∞–µ—Ç!)
‚îú‚îÄ 100 –Ω—Å  ‚Üí 1.2 –æ—Ç—Å—á—ë—Ç–æ–≤    ‚úÖ –î—Ä–æ–±–Ω–∞—è (—Ä–∞–±–æ—Ç–∞–µ—Ç!)
‚îú‚îÄ 200 –Ω—Å  ‚Üí 2.4 –æ—Ç—Å—á—ë—Ç–æ–≤    ‚úÖ –î—Ä–æ–±–Ω–∞—è (—Ä–∞–±–æ—Ç–∞–µ—Ç!)
‚îî‚îÄ 1000 –Ω—Å ‚Üí 12 –æ—Ç—Å—á—ë—Ç–æ–≤     ‚úÖ –¶–µ–ª–∞—è (—Ä–∞–±–æ—Ç–∞–µ—Ç!)

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —É–≥–ª–æ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏:
‚îî‚îÄ 0.5¬∞...360¬∞ —Å –ª—é–±—ã–º —à–∞–≥–æ–º ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç!
```

**–ì–ª–∞–≤–Ω–∞—è —Ñ–∏—à–∫–∞:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–¥—Ä–æ–±–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫** < —à–∞–≥–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏!

---

## ‚ö° –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ (10 –ú–ò–ù–£–¢)

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ `IMPLEMENTATION_SUMMARY.md`

### 2. –°–ª–µ–¥—É–π—Ç–µ **9 —à–∞–≥–∞–º** (–ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥):

```
–®–ê–ì 1: –î–æ–±–∞–≤–∏—Ç—å typedef CombinedDelayParam
–®–ê–ì 2: –î–æ–±–∞–≤–∏—Ç—å —á–ª–µ–Ω—ã –∫–ª–∞—Å—Å–∞
–®–ê–ì 3: –î–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—é –º–µ—Ç–æ–¥–∞
–®–ê–ì 4: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
–®–ê–ì 5: –û–±–Ω–æ–≤–∏—Ç—å –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä
–®–ê–ì 6: –û–±–Ω–æ–≤–∏—Ç—å move-–æ–ø–µ—Ä–∞—Ü–∏–∏
–®–ê–ì 7: –ó–∞–≥—Ä—É–∑–∏—Ç—å kernel –≤ LoadKernels()
–®–ê–ì 8: –î–æ–±–∞–≤–∏—Ç—å kernel –≤ GetKernelSource()
–®–ê–ì 9: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å signal_combined_delays()
```

### 3. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –∏ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:

```bash
g++ -std=c++17 test_combined_delays.cpp ... -lOpenCL
./a.out
```

### ‚úÖ –ì–û–¢–û–í–û!

---

## üíª –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

```cpp
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
gpu::OpenCLCore::Initialize(gpu::DeviceType::GPU);
gpu::CommandQueuePool::Initialize(4);
gpu::OpenCLComputeEngine::Initialize(gpu::DeviceType::GPU);

// –°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
LFMParameters params;
params.f_start = 1.0e6f;
params.f_stop = 2.0e6f;
params.sample_rate = 12.0e6f;  // ‚Üê –í–∞—à–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏—è
params.num_beams = 256;
params.count_points = 8192;

GeneratorGPU gen(params);

// ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
std::vector<CombinedDelayParam> delays(256);
for (int i = 0; i < 256; i++) {
    delays[i].beam_index = i;
    delays[i].delay_degrees = 0.5f * i;       // 0¬∞ –¥–æ 127.5¬∞
    delays[i].delay_time_ns = 50.0f * i;      // 0 –¥–æ 12700 –Ω—Å
}

// ‚úÖ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª!
cl_mem signal = gen.signal_combined_delays(delays.data(), delays.size());

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å
gen.ClearGPU();
auto beam0 = gen.GetSignalAsVector(0);
auto beam1 = gen.GetSignalAsVector(1);

std::cout << "–õ—É—á 0: " << beam0.size() << " —Å—ç–º–ø–ª–æ–≤" << std::endl;
std::cout << "–õ—É—á 1: " << beam1.size() << " —Å—ç–º–ø–ª–æ–≤" << std::endl;
```

---

## üìê –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê (–î–õ–Ø –ü–û–ù–ò–ú–ê–ù–ò–Ø)

### –ë–∞–∑–æ–≤—ã–π –õ–ß–ú (–ë–ï–ó –∑–∞–¥–µ—Ä–∂–µ–∫):
```
œÜ(t) = 2œÄ(f_start¬∑t + 0.5¬∑chirp_rate¬∑t¬≤)
```

### –° –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π:
```
œÜ(t) = 2œÄ(f_start¬∑(t-œÑ) + 0.5¬∑chirp_rate¬∑(t-œÑ)¬≤)

–≥–¥–µ œÑ = œÑ_angle + œÑ_time

œÑ_angle = (angle_rad √ó wavelength) / speed_of_light
œÑ_time = delay_time_ns √ó 1e-9

œÑ_samples = œÑ √ó sample_rate (–º–æ–∂–µ—Ç –±—ã—Ç—å –î–†–û–ë–ù–´–ú!)
```

### –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è (–¥—Ä–æ–±–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞):
```
delayed_index = sample_id - œÑ_samples  (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä–æ–±–Ω—ã–π!)
t_delayed = delayed_index / sample_rate
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É **—Ç–æ—á–Ω–µ–µ**, —á–µ–º —à–∞–≥ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏!

---

## üß™ –ü–†–û–í–ï–†–ö–ê –ö–û–†–†–ï–ö–¢–ù–û–°–¢–ò

```cpp
// 1. –ê–º–ø–ª–∏—Ç—É–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ‚âà 1.0 –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
auto signal = gen.GetSignalAsVector(0);
for (const auto& s : signal) {
    float amp = std::abs(s);
    assert(amp > 0.99f && amp < 1.01f);  // ‚úÖ
}

// 2. –§–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ –∏–∑–º–µ–Ω—è—Ç—å—Å—è –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ (–õ–ß–ú)
// 3. –ù—É–ª–∏ –≤ –Ω–∞—á–∞–ª–µ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞–º
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ì–û–¢–û–í–ù–û–°–¢–ò

- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ CombinedDelayParam —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ Kernel kernel_lfm_combined –Ω–∞–ø–∏—Å–∞–Ω
- ‚úÖ –ú–µ—Ç–æ–¥ signal_combined_delays —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å existing API
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä–æ–±–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫
- ‚úÖ –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è
- ‚úÖ **–ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ! üöÄ**

---

## üìû –ì–î–ï –ù–ê–ß–ê–¢–¨?

1. **–•–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ?** ‚Üí `IMPLEMENTATION_SUMMARY.md` (9 —à–∞–≥–æ–≤)
2. **–•–æ—Ç–∏—Ç–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è?** ‚Üí `ANALYSIS_AND_PLAN.md` (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. **–•–æ—Ç–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã?** ‚Üí `test_combined_delays.cpp` (–≥–æ—Ç–æ–≤—ã–µ —Ç–µ—Å—Ç—ã)
4. **–•–æ—Ç–∏—Ç–µ –∑–Ω–∞—Ç—å –≤—Å–µ?** ‚Üí `README_COMBINED_DELAYS.md` (–ø–æ–ª–Ω—ã–π –≥–∞–π–¥)

---

## üéì –†–ï–ê–õ–¨–ù–´–ô –ü–†–ò–ú–ï–†: –§–ê–ó–ò–†–û–í–ê–ù–ù–ê–Ø –†–ï–®–Å–¢–ö–ê

```cpp
// –ú–∏—à–µ–Ω—å: —É–≥–æ–ª 45¬∞, –¥–∞–ª—å–Ω–æ—Å—Ç—å 1000 –º

float c = 3.0e8f;
float range = 1000.0f;
float angle = 45.0f;

// –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ —Ü–µ–ª–∏ (—Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ)
float delay_ns = (2.0f * range / c) * 1e9f;  // ‚âà 6667 –Ω—Å

std::vector<CombinedDelayParam> delays(256);
for (int i = 0; i < 256; i++) {
    delays[i].beam_index = i;
    
    // –§–∞–∑–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª—É—á–æ–º
    delays[i].delay_degrees = (45.0f / 256.0f) * (i - 128);
    
    // –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –¥–∞–ª—å–Ω–æ—Å—Ç–∏ (–æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è –≤—Å–µ—Ö)
    delays[i].delay_time_ns = delay_ns;
}

// ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏–≥–Ω–∞–ª–∞!
cl_mem signal = gen.signal_combined_delays(delays.data(), delays.size());
```

---

## üéâ –ò–¢–û–ì–û

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ GeneratorGPU:**
- ‚úÖ 1 —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (CombinedDelayParam)
- ‚úÖ 1 kernel (kernel_lfm_combined)
- ‚úÖ 1 –º–µ—Ç–æ–¥ (signal_combined_delays)
- ‚úÖ ‚âà 400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ (kernel + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (—É–≥–æ–ª + –≤—Ä–µ–º—è)
- ‚úÖ –î—Ä–æ–±–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è)
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è GPU –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –ü–æ–ª–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

**–†–ï–®–ï–ù–ò–ï –ì–û–¢–û–í–û! üöÄ**
