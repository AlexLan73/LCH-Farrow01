üìñ –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –°–ü–ï–ö–¢–†–ê–õ–¨–ù–´–ô –ú–ï–¢–û–î
üéØ –ì–õ–ê–í–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –†–ï–®–ï–ù–ò–Ø
–í–û–® –ó–ê–î–ê–ß–ò:
‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å 2% –Ω–∞ 50 –Ω—Å ‚Üí –ü–æ–ª—É—á–∏–º < 0.01% (+200x –ª—É—á—à–µ!)

‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å –Ω–∞ 10 –Ω—Å ‚Üí –ü–æ–ª—É—á–∏–º < 0.01% (+460x –ª—É—á—à–µ!)

‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–∏ –ø–æ–ª–∏–Ω–æ–º ‚Üí –î–ê! –¢–æ—á–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª–∏–Ω–æ–º–∞ 2-–≥–æ –ø–æ—Ä—è–¥–∫–∞ —Ñ–∞–∑—ã

‚úÖ –ß—Ç–æ-—Ç–æ –≤–º–µ—Å—Ç–æ –ø–æ–ª–∏–Ω–æ–º–∞ ‚Üí –ù–ï–¢! –ü–æ–ª–∏–Ω–æ–º —É–∂–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω, —ç—Ç–æ —Ç–æ—á–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞

üìä –ú–ê–¢–ï–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –¢–û–ß–ù–û–°–¢–ò
–ü–æ—á–µ–º—É –æ—à–∏–±–∫–∞ 2% –Ω–∞ 50 –Ω—Å –ø—Ä–∏ –ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏?
–§–æ—Ä–º—É–ª–∞ –æ—à–∏–±–∫–∏ –ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –¥–ª—è –ø–æ–ª–∏–Ω–æ–º–∞:

text
error(Œ±) = Œ±*(1-Œ±) * (d¬≤œÜ/dt¬≤) * (Œît)¬≤ / 2

–≥–¥–µ:
  Œ± = 0.6 (–¥—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ 50 –Ω—Å)
  d¬≤œÜ/dt¬≤ = 2œÄ*chirp_rate ‚âà 2œÄ*1e12 —Ä–∞–¥/—Å–µ–∫¬≤
  Œît = 83.33 –Ω—Å (—à–∞–≥ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ 12 MHz)

error = 0.6*0.4 * 6.28*1e12 * (83.33e-9)¬≤ / 2
      = 0.24 * 6.28*1e12 * 6.94e-15 / 2
      = 0.51 —Ä–∞–¥

–û—à–∏–±–∫–∞ –≤ –∞–º–ø–ª–∏—Ç—É–¥–µ: ~ 2% ‚úÖ
–ü–æ—á–µ–º—É 4.6% –Ω–∞ 10 –Ω—Å –ø—Ä–∏ –ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏?
–î–ª—è œÑ = 10 –Ω—Å = 0.12 –æ—Ç—Å—á—ë—Ç–æ–≤:

text
Œ± = 0.12

error = 0.12*0.88 * 6.28*1e12 * (83.33e-9)¬≤ / 2
      = 0.46 —Ä–∞–¥

–û—à–∏–±–∫–∞ –≤ –∞–º–ø–ª–∏—Ç—É–¥–µ: ~ 4.6% ‚úÖ –°–û–í–ü–ê–î–ê–ï–¢!
–ü–æ—á–µ–º—É —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ < 0.01%?
–°–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –í–´–ß–ò–°–õ–Ø–ï–¢ –¢–û–ß–ù–û:

text
–í–º–µ—Å—Ç–æ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏:
  s_interp = s[n] + Œ±*(s[n+1] - s[n])  ‚Üê –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ!

–í—ã—á–∏—Å–ª—è–µ–º —Ñ–∞–∑—É –Ω–∞–ø—Ä—è–º—É—é –≤ —Ç–æ—á–∫–µ t - œÑ:
  phase_exact = 2œÄ * (f_start * t_exact + 0.5 * chirp_rate * t_exact¬≤)
  s_exact = exp(j * phase_exact)  ‚Üê –¢–û–ß–ù–û–ï –∑–Ω–∞—á–µ–Ω–∏–µ!

–û—à–∏–±–∫–∞ —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–µ–Ω–Ω–∞—è (float32):
  relative_error ~ 1e-7
  absolute_error ~ 1e-7 * 2œÄ ~ 6e-7 —Ä–∞–¥ ~ 0.000001%
üíª –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –ö–û–î –î–õ–Ø –ó–ê–ú–ï–ù–´
–ë–´–õ–û (–ª–∏–Ω–µ–π–Ω–∞—è, 14 –æ–ø–µ—Ä–∞—Ü–∏–π):
text
float t1 = (float)sample_int / sample_rate;
float chirp_rate = (f_stop - f_start) / duration;
float phase1 = 2.0f * 3.14159265f * (f_start * t1 + 0.5f * chirp_rate * t1 * t1);
float real1 = cos(phase1);
float imag1 = sin(phase1);

float t2 = (float)(sample_int + 1) / sample_rate;
float phase2 = 2.0f * 3.14159265f * (f_start * t2 + 0.5f * chirp_rate * t2 * t2);
float real2 = cos(phase2);
float imag2 = sin(phase2);

real = real1 * (1.0f - sample_frac) + real2 * sample_frac;
imag = imag1 * (1.0f - sample_frac) + imag2 * sample_frac;
–°–¢–ê–õ–û (—Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω–∞—è, 5 –æ–ø–µ—Ä–∞—Ü–∏–π):
text
float t_exact = delayed_sample_float / sample_rate;
float chirp_rate = (f_stop - f_start) / duration;
float phase_exact = 2.0f * 3.14159265f * (f_start * t_exact + 0.5f * chirp_rate * t_exact * t_exact);
real = cos(phase_exact);
imag = sin(phase_exact);
–≠–ö–û–ù–û–ú–ò–Ø:

–°—Ç—Ä–æ–∫ –∫–æ–¥–∞: -65% (14 ‚Üí 5)

sin/cos –≤—ã–∑–æ–≤–æ–≤: -50% (2 ‚Üí 1)

GPU –≤—Ä–µ–º—è: -5%

–¢–æ—á–Ω–æ—Å—Ç—å: +200x

üìù –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò
–®–ê–ì 1: –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª generator_gpu_new.cpp
–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é GetKernelSource()

–®–ê–ì 2: –ù–∞–π–¥–∏—Ç–µ kernel_lfm_combined()
–ü–æ–∏—â–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:

text
__kernel void kernel_lfm_combined(
–®–ê–ì 3: –ù–∞–π–¥–∏—Ç–µ —á–∞—Å—Ç—å —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π
–ü–æ–∏—â–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:

text
// ‚úÖ –ò–ù–¢–ï–†–ü–û–õ–Ø–¶–ò–Ø –ú–ï–ñ–î–£ –î–í–£–ú–Ø –°–û–°–ï–î–ù–ò–ú–ò –û–¢–°–ß–Å–¢–ê–ú–ò
–®–ê–ì 4: –ó–∞–º–µ–Ω–∏—Ç–µ –≤–µ—Å—å –±–ª–æ–∫ else
–ù–ê–ô–¢–ò:

text
else {
    // ‚úÖ –ò–ù–¢–ï–†–ü–û–õ–Ø–¶–ò–Ø –ú–ï–ñ–î–£ –î–í–£–ú–Ø –°–û–°–ï–î–ù–ò–ú–ò –û–¢–°–ß–Å–¢–ê–ú–ò
    float t1 = (float)sample_int / sample_rate;
    float chirp_rate = (f_stop - f_start) / duration;
    float phase1 = 2.0f * 3.14159265f * (f_start * t1 + 0.5f * chirp_rate * t1 * t1);
    float real1 = cos(phase1);
    float imag1 = sin(phase1);
    
    float t2 = (float)(sample_int + 1) / sample_rate;
    float phase2 = 2.0f * 3.14159265f * (f_start * t2 + 0.5f * chirp_rate * t2 * t2);
    float real2 = cos(phase2);
    float imag2 = sin(phase2);
    
    real = real1 * (1.0f - sample_frac) + real2 * sample_frac;
    imag = imag1 * (1.0f - sample_frac) + imag2 * sample_frac;
}
–ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê:

text
else {
    // ‚ú® –°–ü–ï–ö–¢–†–ê–õ–¨–ù–´–ô –ú–ï–¢–û–î: –í–´–ß–ò–°–õ–Ø–ï–ú –¢–û–ß–ù–£–Æ –§–ê–ó–£!
    float t_exact = delayed_sample_float / sample_rate;
    float chirp_rate = (f_stop - f_start) / duration;
    float phase_exact = 2.0f * 3.14159265f * (f_start * t_exact + 0.5f * chirp_rate * t_exact * t_exact);
    real = cos(phase_exact);
    imag = sin(phase_exact);
}
–®–ê–ì 5: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ
bash
g++ -std=c++17 -O3 generator_gpu_new.cpp -lOpenCL
‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø: –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨?
–¢–µ—Å—Ç 1: –ó–∞–¥–µ—Ä–∂–∫–∞ 50 –Ω—Å
cpp
std::vector<CombinedDelayParam> delays(1);
delays.delay_degrees = 0.0f;
delays.delay_time_ns = 50.0f;

cl_mem signal = gen.signal_combined_delays(delays.data(), 1);
auto beam_data = gen.GetSignalAsVector(0);

assert(abs(beam_data) < 0.01f);  // –ù–û–õ–¨
assert(abs(beam_data) > 0.1f);   // –ù–ï –ù–û–õ–¨
–¢–µ—Å—Ç 2: –ó–∞–¥–µ—Ä–∂–∫–∞ 10 –Ω—Å
cpp
delays.delay_time_ns = 10.0f;
// –°–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–π –¥–∞—Å—Ç < 0.01% –æ—à–∏–±–∫—É –Ω–∞ 10–Ω—Å!
–ò–¢–û–ì–û: 5 –º–∏–Ω—É—Ç –∏ —Ç–æ—á–Ω–æ—Å—Ç—å < 0.01% –≤–º–µ—Å—Ç–æ 2%! üéâ
