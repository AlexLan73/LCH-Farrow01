# üîç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó kernel_fractional_delay.cl

## üìã –ó–ê–î–ê–ß–ê (–¢–ó)
- **–ê–Ω—Ç–µ–Ω—ã**: 256
- **–û—Ç—Å—á—ë—Ç—ã –Ω–∞ –∞–Ω—Ç–µ–Ω—É**: 1,300,000 (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ, float2)
- **–ú–∞—Ç—Ä–∏—Ü–∞ –õ–∞–≥—Ä–∞–Ω–∂–∞**: 48√ó5 (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ 5-–≥–æ –ø–æ—Ä—è–¥–∫–∞)
- **–î—Ä–æ–±–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: 48√ó5 (–∫–∞–∫ –º–∞—Ç—Ä–∏—Ü–∞)
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: In-place –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –º–∏–Ω–∏–º—É–º –ø–∞–º—è—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏
- **–§–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–∞**: –û–¥–∏–Ω –≤–µ–∫—Ç–æ—Ä [antenna_0[0..n-1], antenna_1[0..n-1], ..., antenna_255[0..n-1]]

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)

### 1. **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• –î–õ–Ø –ü–ê–†–ê–õ–õ–ï–õ–ò–ó–ú–ê** 
‚ùå –¢–µ–∫—É—â–µ–µ: `global_id = beam * num_samples + sample`
- Work item –ø–æ–ª—É—á–∞–µ—Ç: `idx = 0` ‚Üí beam=0, sample=0
- Work item –ø–æ–ª—É—á–∞–µ—Ç: `idx = 1` ‚Üí beam=0, sample=1
- **–ü–†–û–ë–õ–ï–ú–ê**: –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø–æ –∞–Ω—Ç–µ–Ω–∞–º, –∞ –Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø–æ –æ—Ç—Å—á—ë—Ç–∞–º!

‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–û**: –ù—É–∂–Ω–∞ –ü–û–ü–ï–†–ï–ß–ù–ê–Ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è!
```
idx = 0 ‚Üí sample 0 –≤—Å–µ—Ö 256 –∞–Ω—Ç–µ–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
idx = 1 ‚Üí sample 1 –≤—Å–µ—Ö 256 –∞–Ω—Ç–µ–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
```

---

### 2. **–ü–†–û–ë–õ–ï–ú–ê –° –î–û–°–¢–£–ü–û–ú –ö –ü–ê–ú–Ø–¢–ò (–ì–õ–ê–í–ù–ê–Ø!)**
‚ùå –¢–µ–∫—É—â–µ–µ:
```
global_id = 0,1,2,...,1300000 (antenna 0)
global_id = 1300001,... (antenna 1)
```
- **–ö–∞—à–∞ÃÅ—â–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏** (coalescing –†–ê–ó–†–£–®–ï–ù–ê!)
- –°–æ—Å–µ–¥–Ω–∏–µ work items –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ **—Ä–∞–∑–Ω—ã–º –∞–Ω—Ç–µ–Ω–∞–º** ‚Üí **CAH–ï MISS**
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏: ~10% –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞ –≤–º–µ—Å—Ç–æ 70-90%

‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–û**: –í—Å–µ 256 –∞–Ω—Ç–µ–Ω –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å –û–î–ò–ù –æ—Ç—Å—á—ë—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
```
global_id –≤ range [0, 256) ‚Üí —á–∏—Ç–∞—é—Ç sample_0 –≤—Å–µ—Ö –∞–Ω—Ç–µ–Ω
–≠—Ç–æ –¥–∞—ë—Ç –ò–î–ï–ê–õ–¨–ù–û–ï coalescing –≤ –ø–∞–º—è—Ç–∏!
```

---

### 3. **–ì–†–ê–ù–ò–ß–ù–´–ï –£–°–õ–û–í–ò–Ø –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´**
‚ùå –¢–µ–∫—É—â–µ–µ:
```c
if (idx0 >= 0 && idx0 < (int)num_samples) {
    float2 sample = input[base_offset + idx0];
    // –∏—Å–ø–æ–ª—å–∑—É–µ–º
}
```
- **–í–ª–æ–∂–µ–Ω–Ω—ã–µ if'—ã** (5 —É—Ä–æ–≤–Ω–µ–π!) ‚Üí –û—á–µ–Ω—å –ø–ª–æ—Ö–æ –¥–ª—è GPU
- –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ç–æ—á–∫–∞ –≤–Ω–µ –≥—Ä–∞–Ω–∏—Ü ‚Üí —á–∞—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ = 0
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º –Ω–∞ –∫—Ä–∞—è—Ö**

‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–û**: –û—Ç—Ä–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –î–û –≤—Å–µ—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
```c
// –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤–∞–ª–∏–¥–Ω—ã –ü–û–°–õ–ï reflect_boundary
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–æ–∫ ‚Üí –ª—É—á—à–µ –¥–ª—è GPU
```

---

### 4. **–ù–ï–≠–§–§–ï–ö–¢–ò–í–ù–û–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï LOCAL MEMORY**
‚ùå –¢–µ–∫—É—â–µ–µ: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –≤–æ–æ–±—â–µ
- –ö–∞–∂–¥—ã–π work item –ª–µ–∑–µ—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å 5 —Ä–∞–∑
- **–ó–∞–¥–µ—Ä–∂–∫–∞**: 100-400 —Ü–∏–∫–ª–æ–≤ –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ
- –ù–∞ GPU —Å 256 –∞–Ω—Ç–µ–Ω–∞–º–∏ —ç—Ç–æ **–û–ì–†–û–ú–ù–û–ï —É–∑–∫–æ–µ –º–µ—Å—Ç–æ**

‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–û**:
- **Work group size**: 256 (–ø–æ —á–∏—Å–ª—É –∞–Ω—Ç–µ–Ω)
- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –õ–∞–≥—Ä–∞–Ω–∂–∞ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: –ö–∞–∂–¥—ã–π work item —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–µ–π –∞–Ω—Ç–µ–Ω–æ–π
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 5x —É—Å–∫–æ—Ä–µ–Ω–∏–µ –º–∏–Ω–∏–º—É–º

---

### 5. **–°–¢–†–£–ö–¢–£–†–ê DELAY_PARAMS –ù–ï–û–ü–¢–ò–ú–ê–õ–¨–ù–ê**
‚ùå –¢–µ–∫—É—â–µ–µ: –û–¥–∏–Ω delay_params –Ω–∞ –ª—É—á (–∞–Ω—Ç–µ–Ω—É)
```c
__global const DelayParams* delay_params,
```
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç **–∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–∞–Ω–Ω—ã—Ö** –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å —Ä–∞–∑–Ω—ã–π params
- –û—á–µ–Ω—å –Ω–µ—É–¥–æ–±–Ω–æ –ø—Ä–∏ in-place –æ–±—Ä–∞–±–æ—Ç–∫–µ

‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–û**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏

---

## üü° –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø (–ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´)

### 6. **REFLECT_BOUNDARY –ú–û–ñ–ï–¢ –ë–´–¢–¨ –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û–ô**
```c
if (idx < 0) {
    return -idx;  // –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
    // –ï—Å–ª–∏ idx = -1, return 1 ‚úì
    // –ï—Å–ª–∏ idx = -2, return 2 ‚úì
    // –ù–æ —ç—Ç–æ –Ω–µ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ!
}
```
‚ùì –ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å, —ç—Ç–æ –ª–∏ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è?

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ:
```c
if (idx < 0) {
    idx = -(idx + 1);  // –û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å –µ–¥–∏–Ω–∏—Ü–µ–π
}
if (idx >= (int)num_samples) {
    idx = 2 * (int)num_samples - idx - 1;  // –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ
}
```

---

### 7. **MAD() –ú–û–ñ–ï–¢ –ù–ï –†–ê–ë–û–¢–ê–¢–¨ –ö–ê–ö –û–ñ–ò–î–ê–ï–¢–°–Ø**
- `mad(a, b, c)` = `a*b + c` (fused multiply-add)
- –ù–æ –ø–æ—Ä—è–¥–æ–∫ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **–ø–æ—Ç–µ—Ä–µ —Ç–æ—á–Ω–æ—Å—Ç–∏**
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ **–≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å**, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤ `result += coeff * sample`

---

## ‚úÖ –ß–¢–û –ü–†–ê–í–ò–õ–¨–ù–û

1. ‚úì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `float2` –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö —á–∏—Å–µ–ª
2. ‚úì –ú–∞—Ç—Ä–∏—Ü–∞ –õ–∞–≥—Ä–∞–Ω–∂–∞ 48√ó5 –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ (—Ö–æ—Ä–æ—à–æ!)
3. ‚úì –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ü–∏–∫–ª–∞ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
4. ‚úì In-place –∑–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

---

## üìä –¢–ï–ö–£–©–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ (–û–¶–ï–ù–ö–ê)

```
–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –ø–∏–∫: 256 –∞–Ω—Ç–µ–Ω √ó 1.3–ú –æ—Ç—Å—á—ë—Ç–æ–≤ = 336.8–ú float2 –æ–ø–µ—Ä–∞—Ü–∏–π

–° –¢–ï–ö–£–©–ï–ô –ê–†–•–ò–¢–ï–ö–¢–£–†–û–ô:
- Coalescing: ‚ùå –†–ê–ó–†–£–®–ï–ù–ê
- Memory bandwidth: ~10% –æ—Ç max
- Work item divergence: –í–´–°–û–ö–ê–Ø
- Local memory usage: –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø

–û–ñ–ò–î–ê–ï–ú–û–ï –í–†–ï–ú–Ø: ~2-5 —Å–µ–∫ –Ω–∞ AMD GPU

–ü–û–°–õ–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò:
- Coalescing: ‚úÖ –ò–î–ï–ê–õ–¨–ù–ê–Ø
- Memory bandwidth: ~80% –æ—Ç max
- Work item divergence: –ú–ò–ù–ò–ú–ê–õ–¨–ù–ê–Ø
- Local memory: –û–ü–¢–ò–ú–ê–õ–¨–ù–û–ï

–û–ñ–ò–î–ê–ï–ú–û–ï –í–†–ï–ú–Ø: ~200-400 –º—Å (10x —É—Å–∫–æ—Ä–µ–Ω–∏–µ!)
```

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ü–ï–†–ï–ü–ò–°–´–í–ê–ù–ò–Æ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: **–ü–û–ü–ï–†–ï–ß–ù–ê–Ø –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```c
// –í–ú–ï–°–¢–û: beam * num_samples + sample
// –ü–ò–®–ï–ú: sample * num_beams + beam
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
1. –í—Å–µ 256 –∞–Ω—Ç–µ–Ω —á–∏—Ç–∞—é—Ç –û–î–ò–ù –æ—Ç—Å—á—ë—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
2. Coalescing: **–ò–î–ï–ê–õ–¨–ù–´–ô**
3. Local memory: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**–ö–æ–¥**:
```c
uint global_id = get_global_id(0);
uint total_items = num_beams * num_samples;

if (global_id >= total_items) return;

// –ù–û–í–û–ï –í–´–ß–ò–°–õ–ï–ù–ò–ï:
uint sample_id = global_id / num_beams;
uint beam_id = global_id % num_beams;
```

---

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: **2D WORK GROUP**

```c
// –õ—É—á—à–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
size_t work_group_size[2] = {256, 1};  // 256 –∞–Ω—Ç–µ–Ω, 1 –æ—Ç—Å—á—ë—Ç –∑–∞ —Ä–∞–∑

// –ò–ª–∏: {16, 16} –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö GPU
```

---

## üéØ –ò–¢–û–ì–û–í–´–ï –í–´–í–û–î–´

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|--------|--------|-------------|
| –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| Memory coalescing | ‚ùå –†–ê–ó–†–£–®–ï–ù–ê | üî¥ –ö–†–ò–¢–ò–ß–ù–û |
| –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è | ‚ö†Ô∏è –ü–û–î–û–ó–†–ò–¢–ï–õ–¨–ù–û | üü° –°–†–ï–î–ù–Ø–Ø |
| Local memory | ‚ùå –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø | üü° –°–†–ï–î–ù–Ø–Ø |
| In-place –æ–±—Ä–∞–±–æ—Ç–∫–∞ | ‚úì –ü–†–ê–í–ò–õ–¨–ù–û | ‚úì –•–û–†–û–®–û |
| –ú–∞—Ç—Ä–∏—Ü–∞ –õ–∞–≥—Ä–∞–Ω–∂–∞ | ‚úì –û–ü–¢–ò–ú–ê–õ–¨–ù–û | ‚úì –•–û–†–û–®–û |

**–ì–õ–ê–í–ù–´–ô –í–´–í–û–î**: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö!
