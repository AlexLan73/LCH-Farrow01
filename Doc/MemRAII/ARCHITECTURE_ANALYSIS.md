# üèóÔ∏è –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

**–î–∞—Ç–∞**: 2026-01-10  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω

---

## üìã –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **OpenCLManager** (—Å–∏–Ω–≥–ª—Ç–æ–Ω)
   - –£–ø—Ä–∞–≤–ª—è–µ—Ç: Platform, Device, Context, Queue
   - –ö—ç—à–∏—Ä—É–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã
   - –ù–ï —É–ø—Ä–∞–≤–ª—è–µ—Ç GPU –ø–∞–º—è—Ç—å—é

2. **GPUMemoryManager** (—Å–∏–Ω–≥–ª—Ç–æ–Ω)
   - –ü–æ–ª—É—á–∞–µ—Ç context/queue –∏–∑ OpenCLManager
   - –°–æ–∑–¥–∞–µ—Ç GPUMemoryBuffer
   - –û–±–µ—Ä—Ç—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –±—É—Ñ–µ—Ä—ã

3. **GeneratorGPU** (–æ–±—ã—á–Ω—ã–π –∫–ª–∞—Å—Å)
   - ‚ùå **–ü–†–û–ë–õ–ï–ú–ê**: –°–æ–∑–¥–∞–µ—Ç –°–í–û–ô context/queue
   - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenCLManager
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç cl_mem –±—É—Ñ–µ—Ä—ã –∏–∑ —Å–≤–æ–µ–≥–æ context

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ -34 (CL_INVALID_CONTEXT)

### –°—Ü–µ–Ω–∞—Ä–∏–π –æ—à–∏–±–∫–∏:

```
1. GeneratorGPU —Å–æ–∑–¥–∞–µ—Ç –±—É—Ñ–µ—Ä –≤ context_A
2. GPUMemoryManager –ø–æ–ª—É—á–∞–µ—Ç context_B –∏–∑ OpenCLManager
3. GPUMemoryManager::WrapExternalBuffer() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç context_B
4. clEnqueueReadBuffer(queue_B, buffer_from_context_A) ‚Üí –û–®–ò–ë–ö–ê -34
```

### –ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:

- OpenCL —Ç—Ä–µ–±—É–µ—Ç: `queue` –∏ `buffer` –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å **–û–î–ù–û–ú–£** context
- GeneratorGPU —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–π context (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenCLManager)
- GPUMemoryManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç context –∏–∑ OpenCLManager
- **Context –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!**

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ï–¥–∏–Ω—ã–π —Å–∏–Ω–≥–ª—Ç–æ–Ω

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      OpenCLManager (Singleton)               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ Platform & Device                         ‚îÇ
‚îÇ ‚Ä¢ Context & Command Queue                    ‚îÇ
‚îÇ ‚Ä¢ Program Cache                              ‚îÇ
‚îÇ ‚Ä¢ GPU Memory Management      ‚Üê –ù–û–í–û–ï        ‚îÇ
‚îÇ   ‚îú‚îÄ CreateBuffer()                          ‚îÇ
‚îÇ   ‚îú‚îÄ WrapExternalBuffer() [—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π]    ‚îÇ
‚îÇ   ‚îî‚îÄ Buffer Registry [–¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –≤ OpenCLManager**
   - `CreateBuffer()` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –±—É—Ñ–µ—Ä
   - `WrapExternalBuffer()` - –æ–±–µ—Ä–Ω—É—Ç—å –≤–Ω–µ—à–Ω–∏–π –±—É—Ñ–µ—Ä
   - `RegisterBuffer()` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - `GetBuffer()` - –ø–æ–ª—É—á–∏—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±—É—Ñ–µ—Ä

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è context**
   - –ü—Ä–∏ `WrapExternalBuffer()` –ø—Ä–æ–≤–µ—Ä—è—Ç—å context –±—É—Ñ–µ—Ä–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `clGetMemObjectInfo(CL_MEM_CONTEXT)`
   - –í—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –µ—Å–ª–∏ context –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

3. **–†–µ–µ—Å—Ç—Ä –±—É—Ñ–µ—Ä–æ–≤**
   - –•—Ä–∞–Ω–∏—Ç—å `std::unordered_map<std::string, std::weak_ptr<GPUMemoryBuffer>>`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±—É—Ñ–µ—Ä–∞ (weak_ptr)

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

### –ë–´–õ–û:

```cpp
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
gpu::OpenCLManager::Initialize(CL_DEVICE_TYPE_GPU);
gpu::GPUMemoryManager::Initialize();

// –°–æ–∑–¥–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–∞
auto buffer = gpu::GPUMemoryManager::CreateBuffer(1024, MemoryType::GPU_WRITE_ONLY);

// –û–±–µ—Ä—Ç–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –±—É—Ñ–µ—Ä–∞
auto wrapper = gpu::GPUMemoryManager::WrapExternalBuffer(external_buffer, 1024, MemoryType::GPU_WRITE_ONLY);
```

### –°–¢–ê–õ–û:

```cpp
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–æ–¥–∏–Ω —Ä–∞–∑)
gpu::OpenCLManager::Initialize(CL_DEVICE_TYPE_GPU);
// GPUMemoryManager::Initialize() –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω!

// –°–æ–∑–¥–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–∞
auto buffer = gpu::OpenCLManager::GetInstance().CreateBuffer(1024, MemoryType::GPU_WRITE_ONLY);

// –û–±–µ—Ä—Ç–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –±—É—Ñ–µ—Ä–∞ (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π)
auto wrapper = gpu::OpenCLManager::GetInstance().WrapExternalBuffer(external_buffer, 1024, MemoryType::GPU_WRITE_ONLY);
```

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### GeneratorGPU –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenCLManager

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** GeneratorGPU —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–π context.

**–†–µ—à–µ–Ω–∏–µ:** GeneratorGPU –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å context –∏–∑ OpenCLManager:

```cpp
// –í GeneratorGPU::InitializeOpenCL():
auto& manager = gpu::OpenCLManager::GetInstance();
context_ = manager.GetContext();
queue_ = manager.GetQueue();
```

**–ù–û:** –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è GeneratorGPU, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ–π.

**–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∞—Ü–∏—è context –≤ `WrapExternalBuffer()` –ø–æ–∫–∞–∂–µ—Ç –æ—à–∏–±–∫—É —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. ‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ context** - –Ω–µ—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
2. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –æ—à–∏–±–∫–∞ -34 –Ω–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç
3. ‚úÖ **–†–µ–µ—Å—Ç—Ä –±—É—Ñ–µ—Ä–æ–≤** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞—Å—á–µ—Ç–∞–º–∏
4. ‚úÖ **–ü—Ä–æ—â–µ API** - –æ–¥–∏–Ω —Å–∏–Ω–≥–ª—Ç–æ–Ω –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
5. ‚úÖ **Thread-safe** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –º—å—é—Ç–µ–∫—Å–∞–º–∏

---

**–ê–≤—Ç–æ—Ä**: AI Assistant (–ö–æ–¥–æ)  
**–î–∞—Ç–∞**: 2026-01-10

