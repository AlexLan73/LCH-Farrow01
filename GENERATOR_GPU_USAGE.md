# üì° GeneratorGPU: –î–≤–∞ –†–µ–∂–∏–º–∞ –†–∞–±–æ—Ç—ã –∏ –û–±–º–µ–Ω —Å CPU –ü–∞–º—è—Ç—å—é

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞**: 2026-01-10  
**–ü—Ä–æ–µ–∫—Ç**: LCH-Farrow

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–î–≤–∞ –†–µ–∂–∏–º–∞ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞](#–¥–≤–∞-—Ä–µ–∂–∏–º–∞-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞)
2. [–û–±–º–µ–Ω –î–∞–Ω–Ω—ã–º–∏ —Å CPU](#–æ–±–º–µ–Ω-–¥–∞–Ω–Ω—ã–º–∏-—Å-cpu)
3. [–ü—Ä–∏–º–µ—Ä—ã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü–∞–º—è—Ç–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø–∞–º—è—Ç–∏)

---

## üéØ –î–≤–∞ –†–µ–∂–∏–º–∞ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

### –†–µ–∂–∏–º 1: `signal_base()` - –ë–∞–∑–æ–≤—ã–π –õ–ß–ú –°–∏–≥–Ω–∞–ª

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ –õ–ß–ú (–ª–∏–Ω–µ–π–Ω–æ-—á–∞—Å—Ç–æ—Ç–Ω–æ-–º–æ–¥—É–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ) —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è –≤—Å–µ—Ö –ª—É—á–µ–π –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `LFMParameters` (–∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞):
  - `f_start` - –Ω–∞—á–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ (–ì—Ü)
  - `f_stop` - –∫–æ–Ω–µ—á–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ (–ì—Ü)
  - `sample_rate` - —á–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ (–ì—Ü)
  - `num_beams` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—É—á–µ–π
  - `duration` / `count_points` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–≥–Ω–∞–ª–∞ / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Å—á—ë—Ç–æ–≤

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `cl_mem` - –∞–¥—Ä–µ—Å GPU –ø–∞–º—è—Ç–∏ —Å –±–∞–∑–æ–≤—ã–º–∏ —Å–∏–≥–Ω–∞–ª–∞–º–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `[ray0_all_samples][ray1_all_samples]...[rayn_all_samples]`
- –†–∞–∑–º–µ—Ä: `num_beams √ó num_samples √ó sizeof(complex<float>)`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```cpp
#include "generator/generator_gpu.h"
#include "interface/lfm_parameters.h"
#include "GPU/opencl_manager.h"

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
gpu::OpenCLManager::Initialize(CL_DEVICE_TYPE_GPU);

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏–≥–Ω–∞–ª–∞
LFMParameters params;
params.f_start = 0.4e6f;      // 400 –∫–ì—Ü
params.f_stop = 0.5e6f;       // 500 –∫–ì—Ü
params.sample_rate = 12e6f;   // 12 –ú–ì—Ü
params.num_beams = 256;       // 256 –ª—É—á–µ–π
params.count_points = 8192;   // 8192 –æ—Ç—Å—á—ë—Ç–∞ –Ω–∞ –ª—É—á

// –°–æ–∑–¥–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
auto generator = std::make_shared<radar::GeneratorGPU>(params);

// –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
cl_mem signal_gpu = generator->signal_base();
// signal_gpu —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ GPU –ø–∞–º—è—Ç–∏
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –±—É—Ñ–µ—Ä –Ω–∞ GPU —á–µ—Ä–µ–∑ `OpenCLManager::CreateBuffer()`
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è OpenCL kernel `kernel_lfm_basic` –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –¥–ª—è –≤—Å–µ—Ö –æ—Ç—Å—á—ë—Ç–æ–≤
3. –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ GPU –≤—ã—á–∏—Å–ª—è–µ—Ç –æ–¥–∏–Ω –æ—Ç—Å—á—ë—Ç –æ–¥–Ω–æ–≥–æ –ª—É—á–∞
4. –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ GPU –ø–∞–º—è—Ç—å
5. –ë—É—Ñ–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ `OpenCLManager` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º

---

### –†–µ–∂–∏–º 2: `signal_valedation()` - –õ–ß–ú –°–∏–≥–Ω–∞–ª —Å –î—Ä–æ–±–Ω–æ–π –ó–∞–¥–µ—Ä–∂–∫–æ–π

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –õ–ß–ú —Å–∏–≥–Ω–∞–ª–æ–≤ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –ø–æ –ª—É—á–∞–º. –í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –Ω–∞ GPU.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `LFMParameters` (–∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞) - –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏–≥–Ω–∞–ª–∞
- `m_delay[]` - –º–∞—Å—Å–∏–≤ `DelayParameter`:
  ```cpp
  struct DelayParameter {
      uint beam_index;      // –ò–Ω–¥–µ–∫—Å –ª—É—á–∞
      float delay_degrees;  // –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö
  };
  ```
- `num_delay_params` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ `m_delay[]` (–æ–±—ã—á–Ω–æ = `num_beams`)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `cl_mem` - –∞–¥—Ä–µ—Å GPU –ø–∞–º—è—Ç–∏ —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏ –ø–æ –ª—É—á–∞–º —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `[ray0_delayed_samples][ray1_delayed_samples]...`
- –†–∞–∑–º–µ—Ä: `num_beams √ó num_samples √ó sizeof(complex<float>)`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```cpp
// –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–µ—Ä–∂–∫–∏
std::vector<DelayParameter> delays(generator->GetNumBeams());
for (size_t i = 0; i < delays.size(); ++i) {
    delays[i].beam_index = i;
    delays[i].delay_degrees = 0.5f * static_cast<float>(i);  // –†–∞–∑–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
}

// –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
cl_mem signal_delayed_gpu = generator->signal_valedation(
    delays.data(),
    delays.size()
);
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –≤—ã—Ö–æ–¥–Ω–æ–π –±—É—Ñ–µ—Ä –Ω–∞ GPU —á–µ—Ä–µ–∑ `OpenCLManager::CreateBuffer()`
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –±—É—Ñ–µ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–¥–µ—Ä–∂–∫–∏ —á–µ—Ä–µ–∑ `OpenCLManager::CreateBufferWithData()`
   - –î–∞–Ω–Ω—ã–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –Ω–∞ GPU –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (`CL_MEM_COPY_HOST_PTR`)
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è OpenCL kernel `kernel_lfm_delayed` –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
4. –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç –æ—Ç—Å—á—ë—Ç —Å —É—á–µ—Ç–æ–º –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è —Å–≤–æ–µ–≥–æ –ª—É—á–∞
5. –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ GPU –ø–∞–º—è—Ç—å
6. –û–±–∞ –±—É—Ñ–µ—Ä–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ `OpenCLManager`

---

## üíæ –û–±–º–µ–Ω –î–∞–Ω–Ω—ã–º–∏ —Å CPU

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –û–±–º–µ–Ω–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CPU –ü–∞–º—è—Ç—å (Host)                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  std::vector<std::complex<float>> cpu_data           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  DelayParameter delays[]                            ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üï DMA Transfer (PCIe)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    GPU –ü–∞–º—è—Ç—å (Device)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  cl_mem gpu_buffer (—á–µ—Ä–µ–∑ OpenCLManager)             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  GPUMemoryBuffer (RAII —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ú–µ—Ç–æ–¥ 1: –û–±–µ—Ä—Ç–∫–∞ –í–Ω–µ—à–Ω–µ–≥–æ –ë—É—Ñ–µ—Ä–∞ (–æ—Ç GeneratorGPU)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ö–æ–≥–¥–∞ `GeneratorGPU` —É–∂–µ —Å–æ–∑–¥–∞–ª –±—É—Ñ–µ—Ä –Ω–∞ GPU –∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –µ–≥–æ –Ω–∞ CPU.

```cpp
#include "GPU/opencl_manager.h"
#include "GPU/gpu_memory_manager.hpp"

// GeneratorGPU —Å–æ–∑–¥–∞–ª —Å–∏–≥–Ω–∞–ª
cl_mem signal_gpu = generator->signal_base();

// –û–±–µ—Ä–Ω—É—Ç—å –¥–ª—è —á—Ç–µ–Ω–∏—è —á–µ—Ä–µ–∑ OpenCLManager
auto& manager = gpu::OpenCLManager::GetInstance();
auto wrapper = manager.WrapExternalBuffer(
    signal_gpu,
    generator->GetTotalSize(),  // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    gpu::MemoryType::GPU_WRITE_ONLY
);

// –ü—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ GPU ‚Üí CPU
std::vector<std::complex<float>> cpu_data = wrapper->ReadFromGPU();

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ CPU
for (size_t i = 0; i < 10; ++i) {
    std::cout << "Sample[" << i << "] = " 
              << cpu_data[i].real() << " + " 
              << cpu_data[i].imag() << "j\n";
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. `WrapExternalBuffer()` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç, —á—Ç–æ –±—É—Ñ–µ—Ä –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É OpenCL context
2. –°–æ–∑–¥–∞–µ—Ç—Å—è `GPUMemoryBuffer` wrapper (non-owning)
3. `ReadFromGPU()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç DMA transfer GPU ‚Üí CPU —á–µ—Ä–µ–∑ pinned memory
4. –î–∞–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–∞–∫ `std::vector<std::complex<float>>`

---

### –ú–µ—Ç–æ–¥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –ë—É—Ñ–µ—Ä–∞ –∏ –ó–∞–ø–∏—Å—å –î–∞–Ω–Ω—ã—Ö

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å CPU –Ω–∞ GPU –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.

```cpp
// –°–æ–∑–¥–∞—Ç—å –±—É—Ñ–µ—Ä —á–µ—Ä–µ–∑ OpenCLManager
auto& manager = gpu::OpenCLManager::GetInstance();
auto buffer = manager.CreateBuffer(
    1024,  // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    gpu::MemoryType::GPU_READ_WRITE
);

// –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ CPU
std::vector<std::complex<float>> cpu_data(1024);
for (size_t i = 0; i < cpu_data.size(); ++i) {
    cpu_data[i] = std::complex<float>(
        std::cos(0.1f * i),
        std::sin(0.1f * i)
    );
}

// –ó–∞–ø–∏—Å–∞—Ç—å CPU ‚Üí GPU
buffer->WriteToGPU(cpu_data);

// –¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ GPU, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ kernels
cl_mem gpu_mem = buffer->Get();
// ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å gpu_mem –≤ OpenCL kernels ...
```

---

### –ú–µ—Ç–æ–¥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –ë—É—Ñ–µ—Ä–∞ —Å –î–∞–Ω–Ω—ã–º–∏ (–æ–¥–Ω–∏–º —à–∞–≥–æ–º)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω–æ —Å—Ä–∞–∑—É —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ GPU –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—É—Ñ–µ—Ä–∞.

```cpp
// –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ CPU
std::vector<DelayParameter> delays(256);
for (size_t i = 0; i < delays.size(); ++i) {
    delays[i].beam_index = i;
    delays[i].delay_degrees = 0.5f * i;
}

// –°–æ–∑–¥–∞—Ç—å –±—É—Ñ–µ—Ä —Å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
auto& manager = gpu::OpenCLManager::GetInstance();
auto delay_buffer = manager.CreateBufferWithData(
    delays.size(),           // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    delays.data(),           // –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
    delays.size() * sizeof(DelayParameter),  // —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
    gpu::MemoryType::GPU_READ_ONLY
);

// –î–∞–Ω–Ω—ã–µ —É–∂–µ –Ω–∞ GPU, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
cl_mem delay_gpu = delay_buffer->Get();
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π –ü—Ä–∏–º–µ—Ä: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ß—Ç–µ–Ω–∏–µ

```cpp
#include "generator/generator_gpu.h"
#include "interface/lfm_parameters.h"
#include "GPU/opencl_manager.h"
#include "GPU/gpu_memory_manager.hpp"
#include <iostream>
#include <vector>

int main() {
    try {
        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenCL
        gpu::OpenCLManager::Initialize(CL_DEVICE_TYPE_GPU);
        auto& manager = gpu::OpenCLManager::GetInstance();
        
        // 2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏–≥–Ω–∞–ª–∞
        LFMParameters params;
        params.f_start = 0.4e6f;
        params.f_stop = 0.5e6f;
        params.sample_rate = 12e6f;
        params.num_beams = 256;
        params.count_points = 8192;
        
        // 3. –°–æ–∑–¥–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
        auto generator = std::make_shared<radar::GeneratorGPU>(params);
        
        // 4. –†–ï–ñ–ò–ú 1: –ë–∞–∑–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
        std::cout << "=== –†–µ–∂–∏–º 1: –ë–∞–∑–æ–≤—ã–π –õ–ß–ú —Å–∏–≥–Ω–∞–ª ===\n";
        cl_mem signal_base_gpu = generator->signal_base();
        
        // 5. –û–±–µ—Ä–Ω—É—Ç—å –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–∞ CPU
        auto wrapper_base = manager.WrapExternalBuffer(
            signal_base_gpu,
            generator->GetTotalSize(),
            gpu::MemoryType::GPU_WRITE_ONLY
        );
        auto cpu_data_base = wrapper_base->ReadPartial(10);  // –ü–µ—Ä–≤—ã–µ 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        
        std::cout << "–ü–µ—Ä–≤—ã–µ 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±–∞–∑–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞:\n";
        for (size_t i = 0; i < 5; ++i) {
            std::cout << "  [" << i << "] = " 
                      << cpu_data_base[i].real() << " + "
                      << cpu_data_base[i].imag() << "j\n";
        }
        
        // 6. –†–ï–ñ–ò–ú 2: –°–∏–≥–Ω–∞–ª —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
        std::cout << "\n=== –†–µ–∂–∏–º 2: –õ–ß–ú —Å–∏–≥–Ω–∞–ª —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ ===\n";
        std::vector<DelayParameter> delays(generator->GetNumBeams());
        for (size_t i = 0; i < delays.size(); ++i) {
            delays[i].beam_index = i;
            delays[i].delay_degrees = 0.5f * static_cast<float>(i);
        }
        
        cl_mem signal_delayed_gpu = generator->signal_valedation(
            delays.data(),
            delays.size()
        );
        
        // 7. –û–±–µ—Ä–Ω—É—Ç—å –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–∞ CPU
        auto wrapper_delayed = manager.WrapExternalBuffer(
            signal_delayed_gpu,
            generator->GetTotalSize(),
            gpu::MemoryType::GPU_WRITE_ONLY
        );
        auto cpu_data_delayed = wrapper_delayed->ReadPartial(10);
        
        std::cout << "–ü–µ—Ä–≤—ã–µ 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–∏–≥–Ω–∞–ª–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏:\n";
        for (size_t i = 0; i < 5; ++i) {
            std::cout << "  [" << i << "] = " 
                      << cpu_data_delayed[i].real() << " + "
                      << cpu_data_delayed[i].imag() << "j\n";
        }
        
        // 8. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏
        std::cout << "\n=== –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏ ===\n";
        manager.PrintMemoryStatistics();
        std::cout << manager.GetKernelCacheStatistics();
        
        return 0;
        
    } catch (const std::exception& e) {
        std::cerr << "–û—à–∏–±–∫–∞: " << e.what() << "\n";
        return 1;
    }
}
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü–∞–º—è—Ç–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–∞–º—è—Ç—å—é —á–µ—Ä–µ–∑ OpenCLManager

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              OpenCLManager (Singleton)                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ –ï–¥–∏–Ω—ã–π OpenCL Context & Queue                            ‚îÇ
‚îÇ ‚Ä¢ –†–µ–µ—Å—Ç—Ä –±—É—Ñ–µ—Ä–æ–≤ (Buffer Registry)                         ‚îÇ
‚îÇ ‚Ä¢ –ö—ç—à –ø—Ä–æ–≥—Ä–∞–º–º –∏ kernels                                    ‚îÇ
‚îÇ ‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º—è—Ç–∏                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ GeneratorGPU   ‚îÇ    ‚îÇ GPUMemoryBuffer    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ signal_base()  ‚îÇ    ‚îÇ ‚Ä¢ ReadFromGPU()    ‚îÇ
‚îÇ signal_valedation()‚îÇ ‚îÇ ‚Ä¢ WriteToGPU()     ‚îÇ
‚îÇ                ‚îÇ    ‚îÇ ‚Ä¢ RAII —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –¶–∏–∫–ª –ë—É—Ñ–µ—Ä–∞

1. **–°–æ–∑–¥–∞–Ω–∏–µ:**
   ```cpp
   auto buffer = manager.CreateBuffer(num_elements, type);
   // –ë—É—Ñ–µ—Ä —Å–æ–∑–¥–∞–Ω –Ω–∞ GPU, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Ä–µ–µ—Å—Ç—Ä–µ
   ```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
   ```cpp
   cl_mem gpu_mem = buffer->Get();  // –ü–æ–ª—É—á–∏—Ç—å cl_mem –¥–ª—è kernels
   // ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ OpenCL kernels ...
   ```

3. **–û–±–º–µ–Ω —Å CPU:**
   ```cpp
   auto cpu_data = buffer->ReadFromGPU();   // GPU ‚Üí CPU
   buffer->WriteToGPU(cpu_data);            // CPU ‚Üí GPU
   ```

4. **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ:**
   ```cpp
   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ (RAII)
   // –ò–ª–∏ —á–µ—Ä–µ–∑ CleanupExpiredBuffers() –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
   ```

---

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. Pinned Memory
- `GPUMemoryBuffer` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç pinned host memory –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ DMA
- –£—Å–∫–æ—Ä—è–µ—Ç –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ GPU ‚Üî CPU

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Kernels
- Kernels –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ `OpenCLManager`
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏

### 3. –†–µ–µ—Å—Ç—Ä –ë—É—Ñ–µ—Ä–æ–≤
- –ë—É—Ñ–µ—Ä—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ expired –±—É—Ñ–µ—Ä–æ–≤

### 4. –ï–¥–∏–Ω—ã–π Context
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π OpenCL context
- –ò—Å–∫–ª—é—á–∞–µ—Ç –æ—à–∏–±–∫–∏ `CL_INVALID_CONTEXT (-34)`

---

## üìù –í–∞–∂–Ω—ã–µ –ó–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–∞–º—è—Ç—å—é

1. **–ù–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–π—Ç–µ `cl_mem` –≤—Ä—É—á–Ω—É—é:**
   ```cpp
   // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
   cl_mem gpu_mem = generator->signal_base();
   clReleaseMemObject(gpu_mem);  // –ù–ï –î–ï–õ–ê–ô–¢–ï –≠–¢–û!
   
   // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
   cl_mem gpu_mem = generator->signal_base();
   auto wrapper = manager.WrapExternalBuffer(gpu_mem, ...);
   // –ü–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ RAII
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `WrapExternalBuffer` –¥–ª—è –±—É—Ñ–µ—Ä–æ–≤ –æ—Ç GeneratorGPU:**
   ```cpp
   // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
   cl_mem signal = generator->signal_base();
   auto wrapper = manager.WrapExternalBuffer(signal, size, type);
   auto data = wrapper->ReadFromGPU();
   ```

3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±—É—Ñ–µ—Ä–æ–≤ –¥–ª—è –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º:**
   ```cpp
   auto buffer = manager.CreateBuffer(1024, type);
   manager.RegisterBuffer("my_buffer", 
       std::shared_ptr<gpu::GPUMemoryBuffer>(buffer.release()));
   // –ë—É—Ñ–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ GetBuffer("my_buffer")
   ```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –î–æ–∫—É–º–µ–Ω—Ç—ã

- `Doc/MemRAII/README.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–∞–º—è—Ç—å—é
- `Doc/MemRAII/API_REFERENCE.md` - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ API
- `Doc/MemRAII/examples_usage.hpp` - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–î–∞—Ç–∞**: 2026-01-10  
**–í–µ—Ä—Å–∏—è**: 1.0

