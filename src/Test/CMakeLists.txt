# ============================================================================
# Test Module CMakeLists (STATIC LIBRARY - includes cpp files)
# src/Test/CMakeLists.txt
# ============================================================================
# –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï: Test –º–æ–¥—É–ª—å (—Ç–µ—Å—Ç—ã –∞–Ω—Ç–µ–Ω–Ω—ã –∏ —Å–∏–≥–Ω–∞–ª–æ–≤)
# ============================================================================

message(STATUS "")
message(STATUS "üîß Processing: src/Test/")
message(STATUS "")

# ============================================================================
# TEST –ú–û–î–£–õ–¨ - STATIC LIBRARY (—Å cpp —Ñ–∞–π–ª–∞–º–∏)
# ============================================================================

# –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã
set(TEST_SOURCES
    test_antenna_fft_proc_max.cpp
    test_signal_sinusoids.cpp
    test_fractional_delay_processor.cpp
)

# –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
add_library(lfm_tests STATIC ${TEST_SOURCES})

message(STATUS "‚úÖ Created library: lfm_tests (STATIC)")
message(STATUS "   Sources: ${TEST_SOURCES}")

# ============================================================================
# –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï INCLUDE –î–ò–†–ï–ö–¢–û–†–ò–ô
# ============================================================================

target_include_directories(lfm_tests PUBLIC
    ${CMAKE_SOURCE_DIR}/include
    ${CMAKE_SOURCE_DIR}/include/Test
    ${CMAKE_SOURCE_DIR}/include/GPU
    ${CMAKE_SOURCE_DIR}/include/ManagerOpenCL
    ${CMAKE_SOURCE_DIR}/include/interface
    ${CMAKE_SOURCE_DIR}/include/radar
    ${CMAKE_SOURCE_DIR}/src
    ${OpenCL_INCLUDE_DIRS}
)

# ============================================================================
# –õ–ò–ù–ö–û–í–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô
# ============================================================================

target_link_libraries(lfm_tests PUBLIC
    lfm_gpu
    lfm_opencl_manager
    OpenCL::OpenCL
)

if(CLFFT_FOUND)
    target_link_libraries(lfm_tests PUBLIC "${CLFFT_LIB}")
    target_include_directories(lfm_tests PUBLIC "${CLFFT_INCLUDE_DIR}")
endif()

if(NLOHMANN_JSON_FOUND)
    target_link_libraries(lfm_tests PUBLIC nlohmann_json::nlohmann_json)
endif()

# ============================================================================
# COMPILE DEFINITIONS
# ============================================================================

target_compile_definitions(lfm_tests PUBLIC
    TEST_MODULE_ENABLED=1
    OPENCL_ENABLED=1
    GPU_MODULE_ENABLED=1
    CL_TARGET_OPENCL_VERSION=300
)

message(STATUS "‚úÖ Test module configured (STATIC library)")

# ============================================================================
# –û–¢–î–ï–õ–¨–ù–´–ô EXECUTABLE –î–õ–Ø –¢–ï–°–¢–û–í FractionalDelayProcessor
# ============================================================================

add_executable(test_fractional_delay test_fractional_delay_processor.cpp)

target_include_directories(test_fractional_delay PRIVATE
    ${CMAKE_SOURCE_DIR}/include
    ${CMAKE_SOURCE_DIR}/include/Test
    ${CMAKE_SOURCE_DIR}/include/GPU
    ${CMAKE_SOURCE_DIR}/include/ManagerOpenCL
    ${CMAKE_SOURCE_DIR}/include/interface
    ${CMAKE_SOURCE_DIR}/include/radar
    ${OpenCL_INCLUDE_DIRS}
)

target_link_libraries(test_fractional_delay PRIVATE
    lfm_gpu
    lfm_opencl_manager
    OpenCL::OpenCL
)

if(CLFFT_FOUND)
    target_link_libraries(test_fractional_delay PRIVATE "${CLFFT_LIB}")
endif()

if(NLOHMANN_JSON_FOUND)
    target_link_libraries(test_fractional_delay PRIVATE nlohmann_json::nlohmann_json)
endif()

target_compile_definitions(test_fractional_delay PRIVATE
    TEST_MODULE_ENABLED=1
    OPENCL_ENABLED=1
    GPU_MODULE_ENABLED=1
    CL_TARGET_OPENCL_VERSION=300
)

message(STATUS "‚úÖ Created executable: test_fractional_delay")
message(STATUS "")
