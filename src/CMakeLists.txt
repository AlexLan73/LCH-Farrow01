# ============================================================================
# Main CMakeLists for src/ (SIMPLIFIED - HEADER ONLY APPROACH)
# src/CMakeLists.txt
# ============================================================================
# –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï: –ì–ª–∞–≤–Ω–∞—è —Å–±–æ—Ä–∫–∞ (header-only –º–æ–¥—É–ª–∏)
# ============================================================================

message(STATUS "")
message(STATUS "üîß Processing: src/ (Main build)")
message(STATUS "")

# ============================================================================
# –ü–û–î–ú–û–î–£–õ–ò (header-only)
# ============================================================================

# OpenCL Manager Library
add_subdirectory(ManagerOpenCL)

# GPU Module (header-only)
add_subdirectory(GPU)

# Tests Module (header-only)
add_subdirectory(Test)

# ============================================================================
# –ò–°–•–û–î–ù–´–ï –§–ê–ô–õ–´ –ì–õ–ê–í–ù–û–ì–û –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
# ============================================================================

set(MAIN_SOURCES
    main.cpp
)

# ============================================================================
# –°–û–ó–î–ê–ù–ò–ï –ò–°–ü–û–õ–ù–Ø–ï–ú–û–ì–û –§–ê–ô–õ–ê
# ============================================================================

add_executable(LCH-Farrow1 ${MAIN_SOURCES})

message(STATUS "üî® Creating main executable: LCH-Farrow1")

# ============================================================================
# –õ–ò–ù–ö–û–í–ö–ê –ë–ò–ë–õ–ò–û–¢–ï–ö –ò –ú–û–î–£–õ–ï–ô
# ============================================================================

# –í–ê–ñ–ù–û: –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø–æ—Ä—è–¥–æ–∫ –∫—Ä–∏—Ç–∏—á–µ–Ω!
# –°–Ω–∞—á–∞–ª–∞ –Ω–∞—à–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –ø–æ—Ç–æ–º –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (clFFT, OpenCL)
target_link_libraries(LCH-Farrow1 PRIVATE
    # –ù–∞—à–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–ø–æ—Ä—è–¥–æ–∫: –æ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –∫ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º)
    lfm_tests               # Tests Module (STATIC) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç lfm_gpu
    lfm_gpu                 # GPU Module (STATIC) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç lfm_opencl_manager
    lfm_opencl_manager      # OpenCL Manager (STATIC) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenCL/clFFT
)

# clFFT –î–û–õ–ñ–ï–ù –±—ã—Ç—å –ü–û–°–õ–ï –Ω–∞—à–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–∫–æ–≤–∫–∞)
if(CLFFT_FOUND)
    target_link_libraries(LCH-Farrow1 PRIVATE "${CLFFT_LIB}")
endif()

# OpenCL –î–û–õ–ñ–ï–ù –±—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–º
target_link_libraries(LCH-Farrow1 PRIVATE OpenCL::OpenCL)

# nlohmann_json
if(NLOHMANN_JSON_FOUND)
    target_link_libraries(LCH-Farrow1 PRIVATE nlohmann_json::nlohmann_json)
endif()

message(STATUS "‚úÖ Linked library: lfm_opencl_manager")
message(STATUS "‚úÖ Linked: OpenCL")
if(CLFFT_FOUND)
    message(STATUS "‚úÖ Linked: clFFT")
endif()

# ============================================================================
# –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï INCLUDE –î–ò–†–ï–ö–¢–û–†–ò–ô
# ============================================================================

target_include_directories(LCH-Farrow1 PRIVATE
    ${CMAKE_SOURCE_DIR}/include
    ${CMAKE_SOURCE_DIR}/include/ManagerOpenCL
    ${CMAKE_SOURCE_DIR}/include/GPU
    ${CMAKE_SOURCE_DIR}/include/Test
    ${CMAKE_SOURCE_DIR}/include/interface
    ${CMAKE_SOURCE_DIR}/include/radar
    ${CMAKE_SOURCE_DIR}/src
    ${OpenCL_INCLUDE_DIRS}
)

# ============================================================================
# COMPILER FLAGS
# ============================================================================

if(MSVC)
    target_compile_options(LCH-Farrow1 PRIVATE /arch:AVX2 /Gy)
else()
    target_compile_options(LCH-Farrow1 PRIVATE -march=native)
endif()

# ============================================================================
# COMPILE DEFINITIONS
# ============================================================================

target_compile_definitions(LCH-Farrow1 PRIVATE
    OPENCL_ENABLED=1
    CLFFT_VERSION=2
    CL_TARGET_OPENCL_VERSION=300
)

# ============================================================================
# SET PROPERTIES
# ============================================================================

set_target_properties(LCH-Farrow1 PROPERTIES
    VERSION 1.0.0
    CXX_STANDARD 17
    CXX_STANDARD_REQUIRED ON
)

message(STATUS "‚úÖ Main executable configured: LCH-Farrow1")
message(STATUS "   Output: build/linux-nvidia/LCH-Farrow1")
message(STATUS "")